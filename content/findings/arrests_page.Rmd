---
title: "Arrests"
description: "What are the trends in arrests in Halifax?"
tags: ["R", "Visualization"]
weight: 3
draft: false
output: html_document
---
 
```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(fig.align = "center")
knitr::opts_chunk$set(out.width = "\\textwidth")
knitr::opts_chunk$set(fig.height = 8)

options(scipen = 10000)
```

```{r load_libs_data}
library(here)
library(dplyr)
library(readr)
library(lubridate)
library(ggplot2)
library(maps)
library(rnaturalearth)
library(rnaturalearthdata)
library(stringr)
library(tidycensus)
library(sf)
library(cowplot)

# all VA arrests between 2010 and 2019
all_va_arrest <- read_csv(here("data", "original", "Crime", "full_va_crime", "clean_all_arrest_all_years.csv"))

# VA county population by race from census
va_pop_by_race <- read_csv(here("data", "original", "Crime", "full_va_crime", "clean_county_pop_by_race.csv"))
```

```{r va_county_map_data}

# get VA state map data
states <- map_data("state")
va_state <- subset(states, region == "virginia")

# get VA county map data
counties <- map_data("county")
va_county <- subset(counties, region == "virginia")

va_county$county_cap <- toupper(va_county$subregion)
```

```{r ggplot_setup}
ditch_the_axis <- theme(
  axis.text = element_blank(),
  axis.line = element_blank(),
  axis.ticks = element_blank(),
  panel.border = element_blank(),
  panel.grid = element_blank(),
  axis.title = element_blank(),
  legend.position = 'top', 
  legend.justification = 'left',
  legend.direction = 'horizontal'
)

va_base <- ggplot(data = va_state, 
                  mapping = aes(x = long, y = lat, group = group)) +
  coord_fixed(1.1) + 
  geom_polygon(color = "black", fill = "gray")
```

## Total arrests

```{r all_arrests}
county_total <- all_va_arrest %>%
  group_by(county_cap) %>%
  tally %>%
  as.data.frame() %>%
  inner_join(va_pop_by_race, by = "county_cap") %>%
  mutate(arrest_per_cap = n/total_pop) %>%
  inner_join(va_county, by = "county_cap")

county_total_plot <- va_base +
  geom_polygon(data = county_total, aes(fill = arrest_per_cap), color = "white") +
  geom_polygon(color = "black", fill = NA) + 
  geom_text(data = county_total %>% filter(county_cap == "HALIFAX") %>% slice(1), 
            aes(x = long - 0.15, y = lat + 0.2, label = "H")) + 
  scale_fill_viridis_c(trans = "sqrt", alpha = .4) +
  theme_bw() +
  ditch_the_axis + 
  guides(fill = guide_legend(title = "Arrests\nper\ncapita"))

county_total_year <- all_va_arrest %>%
  group_by(incident_year, county_cap) %>%
  tally %>%
  as.data.frame() %>%
  inner_join(va_pop_by_race, by = "county_cap") %>%
  mutate(arrest_per_cap = n/total_pop) %>%
  inner_join(va_county, by = "county_cap")

halifax_total_year <- county_total_year %>% filter(county_cap == "HALIFAX")

county_total_year_plot <- ggplot(data = county_total_year %>% filter(county_cap != "HALIFAX"), 
                                 aes(x = incident_year, y = arrest_per_cap, group = county_cap)) + 
  geom_line(alpha = 0.1) +
  geom_line(data = halifax_total_year, 
            aes(x = incident_year, y = arrest_per_cap),
            color = "red", lwd = 1.3) + 
  scale_x_continuous(breaks = c(seq(2010, 2019)),
                     labels = c(seq(2010, 2019))) +
  xlab("Year") + ylab("Arrests per capita") +
  theme_bw()

total_arrest_grid <- plot_grid(county_total_plot, county_total_year_plot,
                               nrow = 2)

total_arrest_title <- ggdraw() + 
  draw_label("Number of total arrests per capita\nin each county from 2010 to 2019", 
             fontface='bold')
plot_grid(total_arrest_title, total_arrest_grid, ncol = 1, rel_heights = c(0.1, 1))

```


```{r black_arrests}
county_black <- all_va_arrest %>%
  filter(offender_race == "Black or African American") %>%
  group_by(county_cap) %>%
  tally %>%
  as.data.frame() %>%
  inner_join(va_pop_by_race, by = "county_cap") %>%
  mutate(black_per_cap = n/pop_Black) %>%
  inner_join(va_county, by = "county_cap")

county_black_plot <- va_base + 
  geom_polygon(data = county_black, aes(fill = black_per_cap), color = "white") +
  geom_polygon(color = "black", fill = NA) +
  geom_text(data = county_black %>% filter(county_cap == "HALIFAX") %>% slice(1), 
            aes(x = long - 0.15, y = lat + 0.2, label = "H")) + 
  scale_fill_viridis_c(trans = "sqrt", alpha = .4) +
  theme_bw() +
  ditch_the_axis + 
  guides(fill = guide_legend(title = "Arrests\nper\ncapita"))

county_black_year <- all_va_arrest %>%
  group_by(incident_year, county_cap) %>%
  tally %>%
  as.data.frame() %>%
  inner_join(va_pop_by_race, by = "county_cap") %>%
  mutate(arrest_per_cap = n/pop_Black) %>%
  inner_join(va_county, by = "county_cap")

halifax_black_year <- county_black_year %>% filter(county_cap == "HALIFAX")

county_black_year_plot <- ggplot(data = county_black_year %>% filter(county_cap != "HALIFAX"), 
                                 aes(x = incident_year, y = arrest_per_cap, group = county_cap)) + 
  geom_line(alpha = 0.1) +
  geom_line(data = halifax_black_year, 
            aes(x = incident_year, y = arrest_per_cap),
            color = "red", lwd = 1.3) + 
  scale_x_continuous(breaks = c(seq(2010, 2019)),
                     labels = c(seq(2010, 2019))) +
  ylim(0, 10) + 
  xlab("Year") + ylab("Arrests per capita") +
  theme_bw()

black_arrest_grid <- plot_grid(county_black_plot, county_black_year_plot,
                               nrow = 2)

black_arrest_title <- ggdraw() + 
  draw_label("Number of Black arrests per capita\nin each county from 2010 to 2019", 
             fontface='bold')
plot_grid(black_arrest_title, black_arrest_grid, ncol = 1, rel_heights = c(0.1, 1))
```


```{r white_arrests}
county_white <- all_va_arrest %>%
  filter(offender_race == "White") %>%
  group_by(county_cap) %>%
  tally %>%
  as.data.frame() %>%
  inner_join(va_pop_by_race, by = "county_cap") %>%
  mutate(white_per_cap = n/pop_White) %>%
  inner_join(va_county, by = "county_cap")

county_white_plot <- va_base + 
  geom_polygon(data = county_white, aes(fill = white_per_cap), color = "white") +
  geom_polygon(color = "black", fill = NA) +
  geom_text(data = county_white %>% filter(county_cap == "HALIFAX") %>% slice(1), 
            aes(x = long - 0.15, y = lat + 0.2, label = "H")) + 
  scale_fill_viridis_c(trans = "sqrt", alpha = .4) +
  theme_bw() +
  ditch_the_axis +
  guides(fill = guide_legend(title = "Arrests\nper\ncapita"))

county_white_year <- all_va_arrest %>%
  group_by(incident_year, county_cap) %>%
  tally %>%
  as.data.frame() %>%
  inner_join(va_pop_by_race, by = "county_cap") %>%
  mutate(arrest_per_cap = n/pop_White) %>%
  inner_join(va_county, by = "county_cap")

halifax_white_year <- county_white_year %>% filter(county_cap == "HALIFAX")

county_white_year_plot <- ggplot(data = county_white_year %>% filter(county_cap != "HALIFAX"), 
                                 aes(x = incident_year, y = arrest_per_cap, group = county_cap)) + 
  geom_line(alpha = 0.1) +
  geom_line(data = halifax_white_year, 
            aes(x = incident_year, y = arrest_per_cap),
            color = "red", lwd = 1.3) + 
  scale_x_continuous(breaks = c(seq(2010, 2019)),
                     labels = c(seq(2010, 2019))) +
  xlab("Year") + ylab("Arrests per capita") +
  theme_bw()

white_arrest_grid <- plot_grid(county_white_plot, county_white_year_plot,
                               nrow = 2)

white_arrest_title <- ggdraw() + 
  draw_label("Number of White arrests per capita\nin each county from 2010 to 2019", 
             fontface='bold')
plot_grid(white_arrest_title, white_arrest_grid, ncol = 1, rel_heights = c(0.1, 1))
```

## Drug arrests

```{r all_drugs}
all_drug <- all_va_arrest %>%
  filter(offense_type == "Drug/Narcotic Violations") %>%
  group_by(county_cap) %>%
  tally %>%
  as.data.frame() %>%
  inner_join(va_pop_by_race, by = "county_cap") %>%
  mutate(drug_per_cap = n/total_pop) %>%
  inner_join(va_county, by = "county_cap")

all_drug_plot <- va_base +  
  geom_polygon(data = all_drug, aes(fill = drug_per_cap), color = "white") +
  geom_polygon(color = "black", fill = NA) +
  geom_text(data = all_drug %>% filter(county_cap == "HALIFAX") %>% slice(1), 
            aes(x = long - 0.15, y = lat + 0.2, label = "H")) + 
  scale_fill_viridis_c(trans = "sqrt", alpha = .4) +
  theme_bw() +
  ditch_the_axis + 
  guides(fill = guide_legend(title = "Arrests\nper\ncapita"))

all_drug_year <- all_va_arrest %>%
  filter(offense_type == "Drug/Narcotic Violations") %>%
  group_by(incident_year, county_cap) %>%
  tally %>%
  as.data.frame() %>%
  inner_join(va_pop_by_race, by = "county_cap") %>%
  mutate(drug_per_cap = n/total_pop) %>%
  inner_join(va_county, by = "county_cap")

halifax_drug_year <- all_drug_year %>% filter(county_cap == "HALIFAX")

all_drug_year_plot <- ggplot(data = all_drug_year %>% filter(county_cap != "HALIFAX"), 
                                aes(x = incident_year, y = drug_per_cap, group = county_cap)) + 
  geom_line(alpha = 0.1) +
  geom_line(data = halifax_drug_year, 
            aes(x = incident_year, y = drug_per_cap),
            color = "red", lwd = 1.3) + 
  scale_x_continuous(breaks = c(seq(2010, 2019)),
                     labels = c(seq(2010, 2019))) +
  xlab("Year") + ylab("Arrests per capita") +
  theme_bw()

all_drug_grid <- plot_grid(all_drug_plot, all_drug_year_plot,
                               nrow = 2)

all_drug_title <- ggdraw() + 
  draw_label("Number of total drug arrests per capita\nin each county from 2010 to 2019", 
             fontface='bold')
plot_grid(all_drug_title, all_drug_grid, ncol = 1, rel_heights = c(0.1, 1))

```

```{r black_drugs}
black_drug <- all_va_arrest %>%
  filter(offense_type == "Drug/Narcotic Violations" & 
           offender_race == "Black or African American") %>%
  group_by(county_cap) %>%
  tally %>%
  as.data.frame() %>%
  inner_join(va_pop_by_race, by = "county_cap") %>%
  mutate(black_per_cap = n/pop_Black) %>%
  inner_join(va_county, by = "county_cap")

black_drug_plot <- va_base +  
  geom_polygon(data = black_drug, aes(fill = black_per_cap), color = "white") +
  geom_polygon(color = "black", fill = NA) +
  geom_text(data = black_drug %>% filter(county_cap == "HALIFAX") %>% slice(1), 
            aes(x = long - 0.15, y = lat + 0.2, label = "H")) + 
  scale_fill_viridis_c(trans = "sqrt", alpha = .4) +
  theme_bw() +
  ditch_the_axis + 
  guides(fill = guide_legend(title = "Arrests\nper\ncapita"))

black_drug_year <- all_va_arrest %>%
  filter(offense_type == "Drug/Narcotic Violations" & 
           offender_race == "Black or African American") %>%
  group_by(incident_year, county_cap) %>%
  tally %>%
  as.data.frame() %>%
  inner_join(va_pop_by_race, by = "county_cap") %>%
  mutate(drug_per_cap = n/pop_Black) %>%
  inner_join(va_county, by = "county_cap")

halifax_black_drug_year <- black_drug_year %>% filter(county_cap == "HALIFAX")

black_drug_year_plot <- ggplot(data = black_drug_year %>% filter(county_cap != "HALIFAX"), 
                                  aes(x = incident_year, y = drug_per_cap, group = county_cap)) + 
  geom_line(alpha = 0.1) +
  geom_line(data = halifax_black_drug_year, 
            aes(x = incident_year, y = drug_per_cap),
            color = "red", lwd = 1.3) + 
  scale_x_continuous(breaks = c(seq(2010, 2019)),
                     labels = c(seq(2010, 2019))) +
  ylim(0, 0.1) + 
  xlab("Year") + ylab("Arrests per capita") +
  theme_bw()

black_drug_grid <- plot_grid(black_drug_plot, black_drug_year_plot,
                               nrow = 2)

black_drug_title <- ggdraw() + 
  draw_label("Number of Black drug arrests per capita\nin each county from 2010 to 2019", 
             fontface='bold')
plot_grid(black_drug_title, black_drug_grid, ncol = 1, rel_heights = c(0.1, 1))

```

```{r white_drugs}
white_drug <- all_va_arrest %>%
  filter(offense_type == "Drug/Narcotic Violations" & 
           offender_race == "White") %>%
  group_by(county_cap) %>%
  tally %>%
  as.data.frame() %>%
  inner_join(va_pop_by_race, by = "county_cap") %>%
  mutate(white_per_cap = n/pop_White) %>%
  inner_join(va_county, by = "county_cap")

white_drug_plot <- va_base +  
  geom_polygon(data = white_drug, aes(fill = white_per_cap), color = "white") +
  geom_polygon(color = "black", fill = NA) +
  geom_text(data = white_drug %>% filter(county_cap == "HALIFAX") %>% slice(1), 
            aes(x = long - 0.15, y = lat + 0.2, label = "H")) + 
  scale_fill_viridis_c(trans = "sqrt", alpha = .4) +
  theme_bw() +
  ditch_the_axis + 
  guides(fill = guide_legend(title = "Arrests\nper\ncapita"))

white_drug_year <- all_va_arrest %>%
  filter(offense_type == "Drug/Narcotic Violations" & 
           offender_race == "White") %>%
  group_by(incident_year, county_cap) %>%
  tally %>%
  as.data.frame() %>%
  inner_join(va_pop_by_race, by = "county_cap") %>%
  mutate(drug_per_cap = n/pop_White) %>%
  inner_join(va_county, by = "county_cap")

halifax_white_drug_year <- white_drug_year %>% filter(county_cap == "HALIFAX")

white_drug_year_plot <- ggplot(data = white_drug_year %>% filter(county_cap != "HALIFAX"), 
                               aes(x = incident_year, y = drug_per_cap, group = county_cap)) + 
  geom_line(alpha = 0.1) +
  geom_line(data = halifax_white_drug_year, 
            aes(x = incident_year, y = drug_per_cap),
            color = "red", lwd = 1.3) + 
  scale_x_continuous(breaks = c(seq(2010, 2019)),
                     labels = c(seq(2010, 2019))) +
  xlab("Year") + ylab("Arrests per capita") +
  theme_bw()

white_drug_grid <- plot_grid(white_drug_plot, white_drug_year_plot,
                               nrow = 2)

white_drug_title <- ggdraw() + 
  draw_label("Number of white drug arrests per capita\nin each county from 2010 to 2019", 
             fontface='bold')
plot_grid(white_drug_title, white_drug_grid, ncol = 1, rel_heights = c(0.1, 1))
```